{"title":"iOS 音频录制以及播放","date":"2019-04-08T10:08:44.000Z","slug":"iOS-音频录制以及播放","updated":"2019-04-08T10:16:42.019Z","content":"<p>在工作中又遇到了音频录制的需求，再次做此记录</p>\n<p>贴上关键代码</p>\n<pre><code>#import &quot;GXHLXRecordVoiceEmailView.h&quot;\n#import &lt;AVFoundation/AVFoundation.h&gt;\n\n@interface GXHLXRecordVoiceEmailView () &lt;AVAudioRecorderDelegate,AVAudioPlayerDelegate&gt; {\n\n    AVAudioRecorder *recorder;//录音对象\n    AVAudioPlayer *player;//播放对象\n    NSURL *fileUrl;//文件路径\n    NSTimer *timer;\n}\n\n\n@property (nonatomic, strong) AVAudioSession *session;\n\n@end\n</code></pre><a id=\"more\"></a>\n<pre><code>@implementation GXHLXRecordVoiceEmailView\n#pragma mark  --- 按住开始录制 ---\n- (IBAction)recordButtonAction:(id)sender {\n\n    // 注意这里必须设置AVAudioSession否则会导致第一次录制失败以及会导致播放时无法使用扬声器播放\n    AVAudioSession *session =[AVAudioSession sharedInstance];\n    NSError *sessionError;\n    [session setCategory:AVAudioSessionCategoryPlayAndRecord error:&amp;sessionError];\n    if (session == nil) {\n\n        NSLog(@&quot;Error creating session: %@&quot;,[sessionError description]);\n    }else{\n\n        [session setActive:YES error:nil];\n    }\n\n    self.session = session;\n\n    NSString *urlStr = [NSHomeDirectory() stringByAppendingPathComponent:@&quot;Documents/GXRecoder.aac&quot;];\n\n    //删除之前的录音\n    [[NSFileManager defaultManager]removeItemAtPath:urlStr error:nil];\n\n\n    fileUrl = [NSURL fileURLWithPath:urlStr];\n\n\n    //(2)设置录音的音频参数\n    /*\n    1 ID号:acc\n    2 采样率(HZ):每秒从连续的信号中提取并组成离散信号的采样个数\n    3 通道的个数:(1 单声道 2 立体声)\n    4 采样位数(8 16 24 32) 衡量声音波动变化的参数\n    5 大端或者小端 (内存的组织方式)\n    6 采集信号是整数还是浮点数\n    7 音频编码质量\n\n    */\n    NSDictionary *info = @{\n    AVFormatIDKey:[NSNumber numberWithInt:kAudioFormatMPEG4AAC],//音频格式\n    AVSampleRateKey:@8000,//采样率\n    AVNumberOfChannelsKey:@1,//声道数\n    AVLinearPCMBitDepthKey:@16,//采样位数\n    AVEncoderAudioQualityKey:[NSNumber numberWithInt:AVAudioQualityHigh],\n\n    };\n\n\n    /*\n    url:录音文件保存的路径\n    settings: 录音的设置\n    error:错误\n    */\n    recorder = [[AVAudioRecorder alloc]initWithURL:fileUrl settings:info error:nil];\n    recorder.delegate = self;\n    recorder.meteringEnabled = YES;\n    [recorder prepareToRecord];\n    [recorder record];\n}\n\n\n\n#pragma mark  --- 抬起停止录制 ---\n- (IBAction)stopRecordAction:(id)sender {\n\n    [recorder stop];\n\n    //手动释放\n    recorder =nil;\n}\n\n#pragma mark  --- 发送点击事件 ---\n- (IBAction)sendRecordEmailAction:(id)sender {\n\n    //多次播放的时候\n    player = nil;\n\n    player = [[AVAudioPlayer alloc]initWithContentsOfURL:fileUrl error:nil];\n\n    if (player) {\n\n        // 注意播放前设置AVAudioSession恢复设置回放标志\n        [self.session setCategory:AVAudioSessionCategoryPlayback error:nil];\n        [player prepareToPlay];\n        [player play];\n\n    }\n}\n</code></pre>","prev":{"title":"<__NSArrayM:XXXXXX> was mutated while being enumerated.","slug":"NSArrayM-XXXXXX-was-mutated-while-being-enumerated"},"next":{"title":"iOS如何定位Masonry约束报错的控件","slug":"iOS如何定位Masonry约束报错的控件"},"link":"http://yoursite.com/post/iOS-音频录制以及播放/"}